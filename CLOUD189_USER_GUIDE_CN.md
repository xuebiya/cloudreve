# 天翼云盘存储驱动使用指南

## 功能说明

天翼云盘（Cloud189）存储驱动允许您将Cloudreve的文件存储到天翼云盘账号中，实现：
- 文件上传到天翼云盘
- 文件下载（通过天翼云盘直链）
- 文件删除
- 目录列表

## 配置步骤

### 第一步：创建天翼云盘存储策略

1. 登录Cloudreve管理后台
2. 进入"存储策略"页面
3. 点击"添加存储策略"
4. 在弹出的对话框中选择"天翼云盘"

![选择天翼云盘](https://via.placeholder.com/600x400?text=Select+Cloud189)

5. 填写配置信息：
   - **策略名称**：给这个存储策略起个名字，例如"我的天翼云盘"
   - **天翼云盘账号**：您的天翼云盘登录账号（手机号或邮箱）
   - **天翼云盘密码**：您的天翼云盘登录密码

6. 点击"创建"按钮

### 第二步：配置用户组

创建存储策略后，需要将其分配给用户组：

1. 进入"用户组管理"页面
2. 找到需要使用天翼云盘的用户组（例如"默认用户组"）
3. 点击"编辑"按钮
4. 在"存储策略"下拉框中选择刚才创建的天翼云盘策略
5. 点击"保存"

![配置用户组](https://via.placeholder.com/600x400?text=Configure+User+Group)

### 第三步：测试上传

1. 以该用户组的用户身份登录Cloudreve
2. 尝试上传一个小文件（建议先测试小于10MB的文件）
3. 上传成功后，可以在天翼云盘网页版或APP中查看文件

## 常见问题

### Q1: 提示"Unknown policy type"错误

**原因：** 用户组没有正确配置存储策略

**解决方法：**
1. 检查用户组的存储策略设置
2. 确保选择了正确的天翼云盘策略
3. 保存后重新登录Cloudreve

### Q2: 上传失败，提示登录错误

**原因：** 天翼云盘账号或密码错误

**解决方法：**
1. 检查存储策略中填写的账号密码是否正确
2. 尝试在天翼云盘官网登录验证
3. 如果密码正确但仍然失败，可能是触发了验证码，请稍后重试

### Q3: 大文件上传失败

**原因：** 天翼云盘对大文件上传有限制

**解决方法：**
1. 检查文件大小是否超过天翼云盘的限制
2. 尝试分片上传（Cloudreve会自动处理）
3. 如果仍然失败，请查看日志获取详细错误信息

### Q4: 下载速度慢

**原因：** 天翼云盘的下载速度受网络和账号类型影响

**解决方法：**
1. 使用天翼云盘会员账号可以获得更快的下载速度
2. 考虑使用CDN加速（需要额外配置）
3. 对于频繁访问的文件，可以考虑使用本地存储策略

### Q5: 文件列表显示不正确

**原因：** 可能是缓存问题或API限制

**解决方法：**
1. 刷新页面重新加载
2. 清除浏览器缓存
3. 检查天翼云盘账号是否正常

## 高级配置

### 分片大小设置

天翼云盘支持分片上传，默认分片大小为10MB。您可以在存储策略的高级设置中调整：

1. 编辑天翼云盘存储策略
2. 找到"分片大小"设置
3. 建议值：10MB - 100MB
4. 保存设置

### 文件命名规则

您可以自定义上传到天翼云盘的文件命名规则：

- **目录命名规则**：`uploads/{uid}/{path}`
  - `{uid}`: 用户ID
  - `{path}`: 原始路径

- **文件命名规则**：`{uuid}_{originname}`
  - `{uuid}`: 随机UUID
  - `{originname}`: 原始文件名

## 技术参数

| 参数 | 说明 | 默认值 |
|------|------|--------|
| 根目录ID | 天翼云盘根目录 | -11 |
| 分片大小 | 上传分片大小 | 10MB |
| 最大分片大小 | 最大允许的分片 | 100MB |
| 超时时间 | API请求超时 | 30秒 |

## 注意事项

1. **账号安全**
   - 请妥善保管天翼云盘账号密码
   - 建议使用专门的账号用于Cloudreve存储
   - 定期更换密码

2. **存储空间**
   - 注意天翼云盘账号的剩余空间
   - 免费账号通常有空间限制
   - 建议使用会员账号获得更大空间

3. **API限制**
   - 天翼云盘对API调用有频率限制
   - 避免短时间内大量上传/下载
   - 如遇到限制，请稍后重试

4. **文件类型**
   - 某些文件类型可能被天翼云盘限制
   - 建议先测试小文件
   - 敏感文件请谨慎上传

## 故障排查

如果遇到问题，请按以下步骤排查：

1. **检查日志**
   ```bash
   # 启动Cloudreve时开启调试模式
   ./cloudreve --debug
   ```

2. **验证账号**
   - 在天翼云盘官网登录测试
   - 确认账号状态正常

3. **检查网络**
   - 确保服务器可以访问天翼云盘API
   - 测试网络连接：`ping cloud.189.cn`

4. **查看数据库**
   ```bash
   # 检查存储策略配置
   sqlite3 cloudreve.db "SELECT id, name, type FROM storage_policies WHERE type='cloud189';"
   ```

5. **重新创建策略**
   - 如果问题持续，尝试删除并重新创建存储策略
   - 确保填写正确的账号密码

## 获取帮助

如果以上方法都无法解决问题，请：

1. 查看完整的错误日志
2. 记录复现步骤
3. 在GitHub提交Issue：https://github.com/xuebiya/cloudreve/issues
4. 提供以下信息：
   - Cloudreve版本
   - 操作系统
   - 错误日志
   - 复现步骤

## 更新日志

### v1.0.0 (2026-01-21)
- ✅ 初始版本
- ✅ 支持文件上传（分片上传）
- ✅ 支持文件下载
- ✅ 支持文件删除
- ✅ 支持目录列表
- ✅ 支持RSA加密登录
- ✅ 支持HMAC-SHA1签名

### 计划功能
- ⏳ Cookie支持（用于验证码处理）
- ⏳ 文件移动/重命名
- ⏳ 文件夹操作
- ⏳ 更详细的错误提示
- ⏳ 上传进度显示优化

## 参考资料

- [天翼云盘官网](https://cloud.189.cn/)
- [Cloudreve文档](https://docs.cloudreve.org/)
- [OpenList天翼云盘驱动](https://github.com/OpenListTeam/OpenList)
