# 天翼云盘驱动 (Cloud189 Driver)

## 简介

这是从 OpenList 项目移植到 Cloudreve 的天翼云盘存储驱动，支持将文件存储到中国电信天翼云盘。

## 功能特性

- ✅ 文件上传（支持分片上传）
- ✅ 文件下载
- ✅ 文件删除
- ✅ 文件列表
- ✅ 自动登录和会话管理
- ❌ 缩略图（暂不支持）
- ❌ 媒体元数据提取（暂不支持）

## 配置说明

### 创建存储策略

在 Cloudreve 管理面板中创建新的存储策略：

1. **策略类型**: 选择 `cloud189`
2. **AccessKey**: 填写天翼云盘账号（手机号或邮箱）
3. **SecretKey**: 填写天翼云盘密码

### 配置示例

```json
{
  "type": "cloud189",
  "access_key": "your_phone_number",
  "secret_key": "your_password"
}
```

## 技术实现

### 登录流程

1. 访问登录页面获取加密配置
2. 使用 RSA 加密用户名和密码
3. 提交登录请求
4. 保持会话状态

### 上传流程

1. 获取 SessionKey
2. 初始化分片上传
3. 计算文件 MD5
4. 分片上传文件内容
5. 完成上传并提交 MD5 校验

### 下载流程

1. 通过文件 ID 获取下载信息
2. 处理重定向获取最终下载链接
3. 返回 HTTPS 下载地址

## 注意事项

1. **账号安全**: AccessKey 和 SecretKey 会以明文形式存储在数据库中，请确保数据库安全
2. **登录限制**: 天翼云盘可能有登录频率限制，建议不要频繁重启服务
3. **文件路径**: 天翼云盘使用文件夹 ID 而非路径，当前实现使用根目录 ID (-11)
4. **分片大小**: 默认分片大小为 10MB，可根据网络情况调整

## 已知限制

1. 不支持文件夹操作（创建、移动、重命名）
2. 不支持生成缩略图
3. 不支持提取媒体元数据
4. 文件路径管理较为简化，仅支持根目录上传

## 移植说明

本驱动从 OpenList v4 项目移植而来，主要改动：

1. 适配 Cloudreve 的 Driver 接口
2. 使用 Cloudreve 的日志系统
3. 使用 Cloudreve 的配置管理
4. 简化了部分功能以适应 Cloudreve 架构

## 参考资料

- [OpenList 项目](https://github.com/OpenListTeam/OpenList)
- [天翼云盘官网](https://cloud.189.cn/)
- [Cloudreve 文档](https://docs.cloudreve.org/)

## 许可证

本驱动代码遵循 Cloudreve 项目的许可证。
